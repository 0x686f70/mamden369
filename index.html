<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MamDen">
    <meta name="theme-color" content="#2d3a4a">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">
    <link rel="manifest" href="manifest.json">
    <title>MamDen</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="mobile-responsive.css">
    <link rel="stylesheet" href="avatar-selector.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <div class="app-container">
        <!-- Home Screen -->
        <div id="home-screen" class="screen">
            <div class="home-content">
                <div class="home-logo">
                    <div class="logo-icon-container">
                        <i data-lucide="gamepad-2" class="logo-lucide"></i>
                    </div>
                    <h1 class="logo-title">MamDen</h1>
                    <p class="logo-subtitle">·ª®ng d·ª•ng ti√™u di·ªát nhau th√¥ng minh</p>
                </div>

                <div class="home-actions">
                    <button class="home-btn home-btn-primary" onclick="startNewGame()">
                        <i data-lucide="plus-circle"></i>
                        <span class="btn-text">Th√™m m·ªõi Game</span>
                    </button>
                    <button class="home-btn home-btn-secondary" onclick="continueGame()" id="continue-btn">
                        <i data-lucide="play-circle"></i>
                        <span class="btn-text">Ti·∫øp t·ª•c Game</span>
                    </button>
                </div>

                <div class="home-saved-games" id="saved-games-section">
                    <h3>Game ƒë√£ l∆∞u</h3>
                    <div id="saved-games-list" class="saved-games-list"></div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen hidden">
            <header class="game-header">
                <div class="header-left">
                    <button class="icon-btn" onclick="showGameList()" title="Danh s√°ch game">
                        <i data-lucide="menu"></i>
                    </button>
                    <button class="icon-btn" onclick="addPlayer()" title="Th√™m ng∆∞·ªùi ch∆°i">
                        <i data-lucide="user-plus"></i>
                    </button>
                    <button class="icon-btn" onclick="resetAllScores()" title="Reset ƒëi·ªÉm">
                        <i data-lucide="rotate-ccw"></i>
                    </button>
                    <button class="icon-btn" onclick="shareGame()" title="Chia s·∫ª">
                        <i data-lucide="share-2"></i>
                    </button>
                    <button class="icon-btn" onclick="openSettings()" title="C√†i ƒë·∫∑t">
                        <i data-lucide="info"></i>
                    </button>
                </div>
                <div class="header-right">
                    <i data-lucide="trophy" class="trophy-icon"></i>
                    <div class="leader-info" id="leader-info">
                        <div class="leader-avatar" id="leader-avatar"></div>
                        <span class="leader-name" id="leader-name">--</span>
                    </div>
                </div>
            </header>

            <div class="win-condition" id="win-condition">
                <i data-lucide="crown" class="crown-icon"></i>
                <span id="win-text"></span>
            </div>

            <section class="players-section">
                <div id="players-list" class="players-list"></div>
            </section>

            <nav class="bottom-nav">
                <button class="nav-btn active" onclick="showHome()">
                    <i data-lucide="home"></i>
                </button>
                <button class="nav-btn" onclick="openSettings()">
                    <i data-lucide="more-horizontal"></i>
                </button>
            </nav>
        </div>

        <!-- New Game Modal -->
        <div id="new-game-modal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3><i data-lucide="gamepad-2" class="modal-icon"></i> T·∫°o Game M·ªõi</h3>
                    <button class="close-btn" onclick="closeNewGameModal()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div class="new-game-form">
                    <div class="form-group" style="display: none;">
                        <label>T√™n Game</label>
                        <input type="text" id="game-name-input" value="MamDen" maxlength="30">
                    </div>
                    <div class="form-group">
                        <label>ƒêi·ªÉm ƒë·ªÉ th·∫Øng</label>
                        <div class="win-options">
                            <button class="win-option active" data-points="50">50 ƒëi·ªÉm</button>
                            <button class="win-option" data-points="100">100 ƒëi·ªÉm</button>
                            <button class="win-option" data-points="200">200 ƒëi·ªÉm</button>
                            <button class="win-option" data-points="0">Kh√¥ng gi·ªõi h·∫°n</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                            <span><i data-lucide="target"
                                    style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;"></i>
                                M√¢m ƒë·ªÅn 369</span>
                            <label class="switch" style="margin: 0;">
                                <input type="checkbox" id="new-game-mode-369">
                                <span class="slider"></span>
                            </label>
                        </label>
                        <p style="font-size: 11px; color: var(--text-secondary); margin: 0;">C·ªông ƒëi·ªÉm 1 ng∆∞·ªùi = Tr·ª´
                            ƒëi·ªÉm ng∆∞·ªùi kh√°c</p>
                    </div>
                    <div class="form-group">
                        <label>Th√™m ng∆∞·ªùi ch∆°i</label>
                        <div class="players-input-list" id="players-input-list">
                            <div class="player-input-item">
                                <input type="text" placeholder="T√™n ng∆∞·ªùi ch∆°i 1" class="player-name-field"
                                    maxlength="20">
                                <button type="button" class="player-avatar-btn" onclick="selectPlayerAvatar(this, 0)"
                                    title="Ch·ªçn icon">
                                    <span class="avatar-preview">üë®</span>
                                </button>
                                <button class="remove-player-input" onclick="removePlayerInput(this)">
                                    <i data-lucide="x"></i>
                                </button>
                            </div>
                            <div class="player-input-item">
                                <input type="text" placeholder="T√™n ng∆∞·ªùi ch∆°i 2" class="player-name-field"
                                    maxlength="20">
                                <button type="button" class="player-avatar-btn" onclick="selectPlayerAvatar(this, 1)"
                                    title="Ch·ªçn icon">
                                    <span class="avatar-preview">üë©</span>
                                </button>
                                <button class="remove-player-input" onclick="removePlayerInput(this)">
                                    <i data-lucide="x"></i>
                                </button>
                            </div>
                        </div>
                        <button class="add-player-input-btn" onclick="addPlayerInput()">
                            <i data-lucide="plus"></i> Th√™m ng∆∞·ªùi ch∆°i
                        </button>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn-cancel" onclick="closeNewGameModal()">H·ªßy</button>
                    <button class="btn-confirm" onclick="confirmNewGame()">
                        <i data-lucide="play"></i> B·∫Øt ƒë·∫ßu
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Avatar Selector Modal -->
        <div id="avatar-selector-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 370px;">
                <div class="modal-header">
                    <h3><i data-lucide="smile" class="modal-icon"></i> Ch·ªçn Icon</h3>
                    <button class="close-btn" onclick="closeAvatarSelector()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div class="avatar-grid" id="avatar-selector-grid" style="max-height: 200px; padding: 8px; gap: 8px;">
                </div>
                <div class="modal-actions">
                    <button class="btn-confirm full-width" onclick="closeAvatarSelector()">
                        <i data-lucide="check"></i> Xong
                    </button>
                </div>
            </div>
        </div>

        <!-- Score Input Modal -->
        <div id="score-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-player-name">C·ªông ƒëi·ªÉm</h3>
                    <button class="close-btn" onclick="closeScoreModal()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div class="score-input-container">
                    <input type="number" id="score-input" placeholder="Nh·∫≠p ƒëi·ªÉm" inputmode="numeric">
                    <div class="quick-scores">
                        <button onclick="quickScore(-50)">-50</button>
                        <button onclick="quickScore(-10)">-10</button>
                        <button onclick="quickScore(10)">+10</button>
                        <button onclick="quickScore(50)">+50</button>
                    </div>
                </div>
                <div id="opponent-select-container" class="opponent-select-container hidden">
                    <label class="opponent-select-label">
                        <i data-lucide="target"></i> Ch·ªçn ng∆∞·ªùi ƒë·ªÅn (369)
                    </label>
                    <div id="opponent-select-list" class="opponent-select-list"></div>
                </div>
                <div class="modal-actions">
                    <button class="btn-subtract" onclick="submitScore('subtract')">
                        <i data-lucide="minus"></i> Tr·ª´
                    </button>
                    <button class="btn-add" onclick="submitScore('add')">
                        <i data-lucide="plus"></i> C·ªông
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i data-lucide="settings" class="modal-icon"></i> C√†i ƒë·∫∑t</h3>
                    <button class="close-btn" onclick="closeSettings()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div class="settings-list">
                    <div class="setting-item">
                        <div class="setting-info">
                            <span class="setting-name"><i data-lucide="target" class="setting-icon"></i> M√¢m ƒë·ªÅn
                                369</span>
                            <span class="setting-desc">2 ng∆∞·ªùi: t·ª± ƒë·ªông ƒë·ªÅn. 3+ ng∆∞·ªùi: ch·ªçn ng∆∞·ªùi ƒë·ªÅn khi c·ªông
                                ƒëi·ªÉm</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="mode-369" onchange="toggleMode369()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <span class="setting-name"><i data-lucide="trophy" class="setting-icon"></i> ƒêi·ªÉm
                                th·∫Øng</span>
                            <span class="setting-desc" id="current-win-points">50 ƒëi·ªÉm</span>
                        </div>
                        <input type="number" id="win-points-input" class="win-points-input" value="50" min="0">
                    </div>
                    <div class="setting-item">
                        <button class="btn-warning full-width" onclick="resetAllScores()">
                            <i data-lucide="rotate-ccw"></i> Reset t·∫•t c·∫£ ƒëi·ªÉm
                        </button>
                    </div>
                    <div class="setting-item">
                        <button class="btn-danger full-width" onclick="deleteCurrentGame()">
                            <i data-lucide="trash-2"></i> X√≥a game n√†y
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Player Modal -->
        <div id="add-player-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i data-lucide="user-plus" class="modal-icon"></i> Th√™m ng∆∞·ªùi ch∆°i</h3>
                    <button class="close-btn" onclick="closeAddPlayerModal()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <input type="text" id="player-name-input" placeholder="T√™n ng∆∞·ªùi ch∆°i" maxlength="20">
                <div class="avatar-selector">
                    <label
                        style="font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; display: block;">Ch·ªçn
                        icon</label>
                    <div class="avatar-grid" id="add-player-avatar-grid"></div>
                </div>
                <div class="modal-actions">
                    <button class="btn-cancel" onclick="closeAddPlayerModal()">H·ªßy</button>
                    <button class="btn-confirm" onclick="confirmAddPlayer()">
                        <i data-lucide="check"></i> Th√™m
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Player Name Modal -->
        <div id="edit-player-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i data-lucide="edit-2" class="modal-icon"></i> ƒê·ªïi t√™n</h3>
                    <button class="close-btn" onclick="closeEditPlayerModal()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <input type="text" id="edit-player-name-input" placeholder="T√™n ng∆∞·ªùi ch∆°i" maxlength="20">
                <div class="avatar-selector">
                    <label
                        style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; display: block;">Ch·ªçn
                        icon</label>
                    <div class="avatar-grid" id="edit-avatar-grid"></div>
                </div>
                <div class="modal-actions">
                    <button class="btn-cancel" onclick="closeEditPlayerModal()">H·ªßy</button>
                    <button class="btn-confirm" onclick="confirmEditPlayerName()">
                        <i data-lucide="check"></i> L∆∞u
                    </button>
                </div>
            </div>
        </div>

        <!-- Game List Modal -->
        <div id="game-list-modal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3><i data-lucide="list" class="modal-icon"></i> Danh s√°ch Game</h3>
                    <button class="close-btn" onclick="closeGameListModal()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div id="game-list-container" class="game-list-container"></div>
            </div>
        </div>

        <!-- Winner Modal -->
        <div id="winner-modal" class="modal hidden">
            <div class="modal-content winner-content">
                <div class="winner-celebration">
                    <div class="winner-trophy">
                        <i data-lucide="trophy" class="winner-trophy-icon"></i>
                    </div>
                    <h2 class="winner-title">Ch√∫c m·ª´ng!</h2>
                    <div class="winner-name" id="winner-name-display"></div>
                    <p class="winner-subtitle">ƒë√£ chi·∫øn th·∫Øng!</p>
                </div>
                <div class="modal-actions single">
                    <button class="btn-confirm full-width" onclick="closeWinnerModal()">
                        <i data-lucide="check"></i> Ti·∫øp t·ª•c
                    </button>
                </div>
            </div>
        </div>

        <!-- Custom Confirm Modal -->
        <div id="confirm-modal" class="modal hidden">
            <div class="modal-content confirm-modal-content">
                <div class="confirm-icon" id="confirm-icon">
                    <i data-lucide="alert-circle"></i>
                </div>
                <h3 class="confirm-title" id="confirm-title">X√°c nh·∫≠n</h3>
                <p class="confirm-message" id="confirm-message">B·∫°n c√≥ ch·∫Øc ch·∫Øn?</p>
                <div class="modal-actions">
                    <button class="btn-cancel" id="confirm-cancel-btn">H·ªßy</button>
                    <button class="btn-danger" id="confirm-ok-btn">
                        <i data-lucide="check"></i> X√°c nh·∫≠n
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toast-container" class="toast-container"></div>

        <!-- Mode Indicator -->
        <div id="mode-indicator" class="mode-indicator hidden">
            <i data-lucide="target"></i> Ch·∫ø ƒë·ªô M√¢m ƒë·ªÅn 369
        </div>
    </div>

    <script src="app.js"></script>
    <script src="avatar-helper.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
</body>

</html>